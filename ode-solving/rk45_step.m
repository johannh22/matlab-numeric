function [Y, E] = rk45_step(Ydot, Yinitial, t, h, m)

% Constants
a = [0, 0.2, 0.3, 0.6, 1.0, 0.875];

b = zeros(6,5);
b(2,:) = [0.2, 0, 0, 0, 0];
b(3,:) = [3.0/40.0, 9.0/40.0, 0, 0, 0];
b(4,:) = [0.3, -0.9, 1.2, 0, 0];
b(5,:) = [-11.0/54.0, 2.5, -70.0/27.0, 35.0/27.0, 0];
b(6,:) = [1631.0/55296.0, 175.0/512.0, 575.0/13824.0, 44275.0/110592.0, 253.0/4096.0];

c = [37.0/378.0, 0, 250.0/621.0, 125.0/594.0, 0, 512.0/1771.0];

dc = [...
  c(1) - 2825.0/27648.0, ...
  0, ...
  c(3) - 18575.0/48384.0, ...
  c(4) - 13525.0/55296.0, ...
  -277.0/14336, ...
  c(6) - 0.25];

% Runge-Kutta: 6 steps for m dimensions
k = zeros(m, 6);

% Pre-allocate output vectors
Y = zeros(m,1);
E = zeros(m,1);

%% Runge-Kutta steps
k(:,1) = h * Ydot(Yinitial, t);
k(:,2) = h * Ydot(Yinitial + b(2,1).*k(:,1), t + a(2)*h);

k(:,3) = h * Ydot(Yinitial + b(3,1).*k(:,1) ...
                           + b(3,2).*k(:,2), t + a(3)*h);
                         
k(:,4) = h * Ydot(Yinitial + b(4,1).*k(:,1) ...
                           + b(4,2).*k(:,2) ...
                           + b(4,3).*k(:,3), t + a(4)*h);

k(:,5) = h * Ydot(Yinitial + b(5,1).*k(:,1) ...
                           + b(5,2).*k(:,2) ...
                           + b(5,3).*k(:,3) ...
                           + b(5,4).*k(:,4), t + a(5)*h);
                         
k(:,6) = h * Ydot(Yinitial + b(6,1).*k(:,1) ...
                           + b(6,1).*k(:,2) ...
                           + b(6,1).*k(:,3) ...
                           + b(6,1).*k(:,4) ...
                           + b(6,1).*k(:,5) , t + a(6)*h);

Y = Yinitial + c(1)*k(:,1) ...
             + c(2)*k(:,2) ...
             + c(3)*k(:,3) ...
             + c(4)*k(:,4) ...
             + c(5)*k(:,5) ...
             + c(6)*k(:,6);

E = Yinitial + dc(1)*k(:,1) ...
             + dc(2)*k(:,2) ...
             + dc(3)*k(:,3) ...
             + dc(4)*k(:,4) ...
             + dc(5)*k(:,5) ...
             + dc(6)*k(:,6);

end %function